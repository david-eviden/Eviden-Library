<div class="container py-5">
    <ul class="alert alert-danger" *ngIf="errors?.length != 0">
        <div class="container">
            <li *ngFor="let err of errors">{{ err }}</li>
        </div>
    </ul>

    <div *ngIf="authService.esAdmin" class="card shadow-lg">
        <div class="card-header">
            <h5 *ngIf="!libro.id">Crear un Libro</h5>
            <h5 *ngIf="libro.id">Editar un Libro</h5>
        </div>
        <div class="card-body">
            <form #librosForm="ngForm">
                <!-- Campo Titulo -->
                <div class="form-group row mb-4">
                    <label for="titulo" class="col-sm-3 col-form-label">Título:</label>
                    <div class="col-sm-9">
                        <input type="text" 
                               class="form-control form-control-lg" 
                               [(ngModel)]="libro.titulo" 
                               name="titulo" 
                               #titulo="ngModel" 
                               placeholder="Título del libro..."
                               maxlength="25" 
                               minlength="2" 
                               required>
                        <div class="alert alert-danger mt-2" *ngIf="titulo.invalid && (titulo.dirty || titulo.touched)">
                            <div *ngIf="titulo.errors?.['required']">
                                El título es requerido
                            </div>
                            <div *ngIf="titulo.errors?.['maxlength']">
                                El título debe estar entre 2 y 25 caracteres
                            </div>
                            <div *ngIf="titulo.errors?.['minlength']">
                                El título debe estar entre 2 y 25 caracteres
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Campo Descripción -->
                <div class="form-group row mb-4">
                    <label for="descripcion" class="col-sm-3 col-form-label">Descripción:</label>
                    <div class="col-sm-9">
                        <textarea 
                               class="form-control form-control-lg" 
                               [(ngModel)]="libro.descripcion" 
                               name="descripcion" 
                               #descripcion="ngModel" 
                               rows="3" 
                               placeholder="Descripción del libro..."
                               minlength="10" 
                               maxlength="250" 
                               required></textarea>
                        <div class="alert alert-danger mt-2" *ngIf="descripcion.invalid && (descripcion.dirty || descripcion.touched)">
                            <div *ngIf="descripcion.errors?.['required']">
                                La descripción es requerida
                            </div>
                            <div *ngIf="descripcion.errors?.['maxlength']">
                                La descripcion debe estar entre 25 y 250 caracteres
                            </div>
                            <div *ngIf="descripcion.errors?.['minlength']">
                                La descripcion debe estar entre 25 y 250 caracteres
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Campo Precio -->
                <div class="form-group row mb-4">
                    <label for="precio" class="col-sm-3 col-form-label">Precio:</label>
                    <div class="col-sm-9">
                        <input type="number" 
                               class="form-control form-control-lg" 
                               [(ngModel)]="libro.precio" 
                               name="precio" 
                               #precio="ngModel" required>
                        <div class="alert alert-danger mt-2" *ngIf="precio.invalid && (precio.dirty || precio.touched)">
                            <div *ngIf="precio.errors?.['required']">
                                El precio es requerido
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Campo Stock -->
                <div class="form-group row mb-4">
                    <label for="stock" class="col-sm-3 col-form-label">Stock:</label>
                    <div class="col-sm-9">
                        <input type="number" 
                               class="form-control form-control-lg" 
                               [(ngModel)]="libro.stock" 
                               name="stock" 
                               #stock="ngModel" required>
                        <div class="alert alert-danger mt-2" *ngIf="stock.invalid && (stock.dirty || stock.touched)">
                            <div *ngIf="stock.errors?.['required']">
                                El stock es requerido
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Campo Imagen -->
                <div class="form-group row mb-4">
                    <label for="imagen" class="col-sm-3 col-form-label">Imagen:</label>
                    <div class="col-sm-9">
                        <input type="text" 
                               class="form-control form-control-lg" 
                               [(ngModel)]="libro.imagen" 
                               name="imagen" 
                               #imagen="ngModel"
                               placeholder="Imagen del libro...">
                        <div class="alert alert-danger mt-2" *ngIf="imagen.invalid && (imagen.dirty || imagen.touched)">
                            <div *ngIf="imagen.errors?.['required']">
                                La imagen es requerida
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Campo Autor -->
                <div class="form-group row mb-4">
                    <label for="autor" class="col-sm-3 col-form-label">Autor:</label>
                    <div class="col-sm-9">
                        <select
                            class="form-select form-select-lg"
                            [(ngModel)]="autorSeleccionado.id"
                            name="autor"
                            #autor="ngModel"
                            required
                            (change)="seleccionarAutor($event)">
                            <option value="0">Seleccione un autor</option>
                            <option *ngFor="let autor of autores" [value]="autor.id">{{ autor.nombre }}</option>
                            <option value="crearAutor">+ Añadir un autor</option>
                        </select>
                        <div class="alert alert-danger mt-2" *ngIf="autor.invalid && (autor.dirty || autor.touched)">
                            <div *ngIf="autor.errors?.['required']">
                                El autor es requerido
                            </div>
                        </div>
                        <div class="alert alert-danger mt-2" *ngIf="autor.valid && autorSeleccionado.id === 0 && (autor.dirty || autor.touched)">
                            Debe seleccionar un autor válido
                        </div>
                    </div>
                </div>

                <!-- Campo Género -->
                <div class="form-group row mb-4">
                    <label for="genero" class="col-sm-3 col-form-label">Género:</label>
                    <div class="col-sm-9">
                        <select
                            class="form-select form-select-lg"
                            [(ngModel)]="generoSeleccionado.id"
                            name="genero"
                            #genero="ngModel"
                            required
                            (change)="seleccionarGenero($event)">
                            <option value="0">Seleccione un género</option>
                            <option *ngFor="let genero of generos" [value]="genero.id">{{ genero.nombre }}</option>
                            <option value="crearGenero">+ Añadir un género</option>
                        </select>
                        <div class="alert alert-danger mt-2" *ngIf="genero.invalid && (genero.dirty || genero.touched)">
                            <div *ngIf="genero.errors?.['required']">
                                El género es requerido
                            </div>
                        </div>
                        <div class="alert alert-danger mt-2" *ngIf="genero.valid && generoSeleccionado.id === 0 && (genero.dirty || genero.touched)">
                            Debe seleccionar un género válido
                        </div>
                    </div>
                </div>

                <!-- Botones de acción -->
                <div class="form-group row mt-5">
                    <div class="col-sm-9 offset-sm-3">
                        <button class="btn btn-success me-3" role="button" (click)="create()" *ngIf="!libro.id" 
                            [disabled]="!librosForm.form.valid || autorSeleccionado.id === 0 || generoSeleccionado.id === 0">
                            <i class="bi bi-plus-lg"></i> Crear
                        </button>
            
                        <button class="btn btn-warning" role="button" (click)="update()" *ngIf="libro.id" 
                            [disabled]="!librosForm.form.valid || autorSeleccionado.id === 0 || generoSeleccionado.id === 0">
                            <i class="bi bi-pencil"></i> Editar
                        </button>            
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>