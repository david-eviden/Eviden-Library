<div class="search-container position-relative" (clickOutside)="onClickOutside($event)">
    <div class="input-group">
        <input class="form-control" type="search" placeholder="Buscar por título, autor o género..."
            [(ngModel)]="searchTerm" (input)="onSearchInput($event)" (keyup.enter)="performFullSearch()"
            name="searchTerm" aria-label="Search">
        <button class="btn btn-primary" (click)="performFullSearch()">
            <i class="fas fa-search"></i>
        </button>
    </div>

    <!-- Dropdown de resultados -->
    <div class="search-dropdown"
        *ngIf="showDropdown && (searchResults.libros.length > 0 || searchResults.autores.length > 0 || searchResults.generos.length > 0)">
        <!-- Libros -->
        <div class="dropdown-section" *ngIf="searchResults.libros.length > 0">
            <h6 class="dropdown-header">Libros</h6>
            <div class="dropdown-item" *ngFor="let libro of searchResults.libros.slice(0, 3)"
                (click)="selectResult('libro', libro)">
                <div class="d-flex align-items-center">
                    <img [src]="libro.imagen || '/img/libroEjemplo.jpg'" class="dropdown-thumbnail me-2"
                        [alt]="'Imagen de '+libro.titulo">
                    <div>
                        <div class="item-title">{{libro.titulo}}</div>
                        <small class="text-muted">{{libro.autores[0]?.nombre}} {{libro.autores[0]?.apellido}}</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Autores -->
        <div class="dropdown-section" *ngIf="searchResults.autores.length > 0">
            <h6 class="dropdown-header">Autores</h6>
            <div class="dropdown-item" *ngFor="let autor of searchResults.autores.slice(0, 2)"
                (click)="selectResult('autor', autor)">
                {{autor.nombre}} {{autor.apellido}}
            </div>
        </div>

        <!-- Géneros -->
        <div class="dropdown-section" *ngIf="searchResults.generos.length > 0">
            <h6 class="dropdown-header">Géneros</h6>
            <div class="dropdown-item" *ngFor="let genero of searchResults.generos.slice(0, 2)"
                (click)="selectResult('genero', genero)">
                {{genero.nombre}}
            </div>
        </div>

        <!-- Ver todos los resultados -->
        <div class="dropdown-divider"></div>
        <div class="dropdown-item text-primary" (click)="performFullSearch()">
            Ver todos los resultados
        </div>
    </div>
</div>